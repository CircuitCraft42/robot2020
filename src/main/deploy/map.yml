---
# WHETHER TO USE THE CAMERA SERVER
useCameraServer: false

########################################################################################################################
# PDP
pdp:
  org.usfirst.frc.team449.robot.jacksonWrappers.PDP:
    '@id': PDP
    canID: 0
    voltagePerCurrentLinReg:
      bufferSize: 250
      rSquaredThreshhold: 0.75

########################################################################################################################
# ROBOT SUBSYSTEMS
subsystems:
#***********************************************************************************************************************
# ROBOT DRIVE
  #  - org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
  #      '@id': drive
  #      #Wheelbase: 2.14
  #      leftMaster:
  #        org.usfirst.frc.team449.robot.generalInterfaces.FPSSmartMotor:
  #          &leftMaster
  #          '@id': leftMaster
  #          type: TALON
  #          name: left
  #          port: 2
  #          PDP:
  #            org.usfirst.frc.team449.robot.jacksonWrappers.PDP: PDP
  #          voltagePerCurrentLinReg:
  #            bufferSize: 250
  #            rSquaredThreshhold: 0.75
  #          reverseOutput: true
  #          reverseSensor: false
  #          enableBrakeMode: true
  #          postEncoderGearing: 0.13333333333
  #          feetPerRotation: .5 #meters per rotation
  #          currentLimit: 35
  #          enableVoltageComp: true
  #          feedbackDevice: QuadEncoder
  #          encoderCPR: 256
  #          startingGear: LOW
  #          perGearSettings:
  #            - &lowGear
  #              gear: LOW
  #              maxSpeed: 2.2
  #              kP: 0.2
  #              feedForwardCalculator:
  #                org.usfirst.frc.team449.robot.jacksonWrappers.FeedForwardCalculators.MappedFeedForwardCalculator:
  #                  kS: 0.954
  #                  kV: 5.19
  #                  kA: 0.573
  #            - &highGear
  #              gear: HIGH
  #              maxSpeed: 5
  #              kP: 0.2
  #              feedForwardCalculator:
  #                org.usfirst.frc.team449.robot.jacksonWrappers.FeedForwardCalculators.MappedFeedForwardCalculator:
  #                  kS: 1.11
  #                  kV: 2.04
  #                  kA: 0.637
  #          updaterProcessPeriodSecs: 0.005
  #          statusFrameRatesMillis: !!map
  #            Status_4_AinTempVbat: 15
  #          slaveVictors:
  #            - port: 4
  #              invertType: FollowMaster
  #            - port: 6
  #              invertType: FollowMaster
  #      rightMaster:
  #        org.usfirst.frc.team449.robot.generalInterfaces.FPSSmartMotor:
  #          <<: *leftMaster
  #          '@id': rightMaster
  #          name: right
  #          port: 1
  #          reverseOutput: false
  #          reverseSensor: false
  #          perGearSettings:
  #            - <<: *lowGear
  #              feedForwardCalculator:
  #                org.usfirst.frc.team449.robot.jacksonWrappers.FeedForwardCalculators.MappedFeedForwardCalculator:
  #                  kS: 0.954
  #                  kV: 5.19
  #                  kA: 0.573
  #            - <<: *highGear
  #              feedForwardCalculator:
  #                org.usfirst.frc.team449.robot.jacksonWrappers.FeedForwardCalculators.MappedFeedForwardCalculator:
  #                  kS: 1.15
  #                  kV: 2.05
  #                  kA: 0.788
  #          slaveVictors:
  #            - port: 3
  #              #inverted: false
  #            - port: 5
  #              #inverted: false
  #      startingOverrideAutoshift: false
  #      ahrs:
  #        org.usfirst.frc.team449.robot.jacksonWrappers.MappedAHRS:
  #          '@id': navX
  #          port: kMXP
  #          invertYaw: true
  #      trackWidthMeters: 0.6
  #      shiftComponent:
  #        org.usfirst.frc.team449.robot.components.ShiftComponent:
  #          '@id': driveShiftComponent
  #          otherShiftables:
  #            - org.usfirst.frc.team449.robot.generalInterfaces.FPSSmartMotor:
  #                leftMaster
  #            - org.usfirst.frc.team449.robot.generalInterfaces.FPSSmartMotor:
  #                rightMaster
  #          piston:
  #            '@id': driveShifter
  #            module: 0
  #            forward: 1
  #            reverse: 0
  #          startingGear: LOW
#***********************************************************************************************************************
# CLIMBER
  - org.usfirst.frc.team449.robot.subsystem.complex.climber.SafeWinchingClimber:
      '@id': climber
      motorSubsystem:
        org.usfirst.frc.team449.robot.subsystem.complex.climber.ClimberCurrentLimited:
          '@id': climberCurrentLimitSystem
          smartMotor:
            org.usfirst.frc.team449.robot.generalInterfaces.FPSSmartMotor:
              '@id': climberMotor
              name: climberMotor
              type: SPARK
              port: 7
              enableBrakeMode: false
          maxPower: 0.1
          powerLimitTimer:
            '@id': climberLimitTimer
            bufferTimeSeconds: 1
      solenoidSubsystem:
        org.usfirst.frc.team449.robot.subsystem.interfaces.solenoid.SolenoidSimple:
          '@id': climberSolenoidSystem
          piston:
            '@id': climberSolenoid
            module: 0
            forward: 3
            reverse: 2
#***********************************************************************************************************************
# INTAKE
  - org.usfirst.frc.team449.robot.subsystem.interfaces.intake.IntakeSimple:
      '@id': intake
      motor:
        org.usfirst.frc.team449.robot.generalInterfaces.FPSSmartMotor:
          '@id': intakeMotor
          name: intakeMotor
          type: SPARK
          port: 42
          enableBrakeMode: true
          PDP: PDP
#***********************************************************************************************************************
# SHOOTER
  - org.usfirst.frc.team449.robot.subsystem.complex.shooter.LoggingFlywheel:
      '@id': shooterFlywheel
      shooterThrottle: 0.3 #.55 #percent
      kickerThrottle: 0.3 #percent
      spinUpTimeoutSecs: 2
      shooterMotor:
        org.usfirst.frc.team449.robot.generalInterfaces.FPSSmartMotor:
          '@id': shooterRightMotor
          type: SPARK
          reverseSensor: false
          port: 7 #TODO
          name: shooterRightMotor
          reverseOutput: true
          enableBrakeMode: true
          PDP: PDP
          enableVoltageComp: true #TODO
      #          perGearSettings:
      #          - gearNum: 0
      #            feedForwardCalculator:
      #              org.usfirst.frc.team449.robot.jacksonWrappers.FeedForwardCalculators.MappedFeedForwardCalculator:
      #                kS: 0
      #                kV: 0 #0.126
      #                kA: 0
      #            maxSpeed: 90 #rps
      #            kP: 0 #5e-5 #0.0001
      #            kI: 0.
      #            kD: 0
      #          startingGearNum: 0 #TODO
      otherShooterMotor:
        org.usfirst.frc.team449.robot.generalInterfaces.FPSSmartMotor:
          '@id': shooterLeftMotor
          type: TALON
          port: 2 #TODO
          name: shooterLeftMotor
          reverseSensor: false
          reverseOutput: false
          enableBrakeMode: true
          PDP: PDP
          enableVoltageComp: true #TODO
          perGearSettings:
            - gearNum: 0
              feedForwardCalculator:
                org.usfirst.frc.team449.robot.jacksonWrappers.FeedForwardCalculators.MappedFeedForwardCalculator:
                  kS: 0
                  kV: 0.126
                  kA: 0
              maxSpeed: 90 #rps
              kP: 0 #0.0001
              kI: 0
              kD: 0
          startingGearNum: 0 #TODO
      kickerMotor:
        org.usfirst.frc.team449.robot.generalInterfaces.FPSSmartMotor:
          '@id': kickerMotor
          type: TALON
          reverseSensor: false
          port: 4 #TODO
          name: kickerMotor
          reverseOutput: false
          enableBrakeMode: true
          PDP: PDP
          enableVoltageComp: false #TODO
  #        org.usfirst.frc.team449.robot.generalInterfaces.simpleMotor.MappedVictorSPX: #TODO TODO
  #          '@id': kickerVictor
  #          port: 7
  #          inverted: false
  #          brakeMode: false
#***********************************************************************************************************************
# FEEDER
  - org.usfirst.frc.team449.robot.subsystem.interfaces.intake.IntakeSimple:
      '@id': feeder
      motor:
        org.usfirst.frc.team449.robot.generalInterfaces.FPSSmartMotor: #TODO TODO
          '@id': feederMotor
          type: TALON
          port: 8 #TODO
          name: feederMotor
          reverseOutput: false
          enableBrakeMode: false
          PDP: PDP
          currentLimit: 10 #TODO
          reverseSensor: false #TODO
          startingGearNum: 0 #TODO
      inSlowVel: 0.1
      inFastVel: 0.2
      outSlowVel: -0.1
      outFastVel: -0.2

########################################################################################################################
# COMMANDS
commands:
  ########################################################################################################################
  # DEFAULT COMMANDS
  defaultCommands:
#***********************************************************************************************************************
  # DRIVE COMMAND (default)
  #    - subsystem:
  #        org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
  #          drive
  #      command:
  #        org.usfirst.frc.team449.robot.commands.multiInterface.drive.UnidirectionalNavXShiftingDefaultDrive:
  #          '@id': defaultDriveCommand
  #          kP: 0.003
  #          kI: 0.0
  #          kD: 0.05
  #          maximumOutput: 1
  #          absoluteTolerance: 0
  #          deadband: 2
  #          maxAngularVelToEnterLoop: 3
  #          inverted: false
  #          highGearAngularCoefficient: 3
  #          rampComponent:
  #            org.usfirst.frc.team449.robot.generalInterfaces.doubleUnaryOperator.RampComponent:
  #              maxIncreasePerSecond: 3
  #              maxDecreasePerSecond: 1.5
  #          driveStraightLoopEntryTimer:
  #            '@id': driveStraightLoopEntryTimer
  #            bufferTimeSeconds: 0.15
  #          subsystem:
  #            org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
  #              drive
  #          oi:
  #            org.usfirst.frc.team449.robot.oi.unidirectional.arcade.OIArcadeWithDPad:
  #              '@id': oi
  #              gamepad:
  #                org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
  #                  '@id': driverGamepad
  #                  port: 1
  #              rotThrottle:
  #                org.usfirst.frc.team449.robot.oi.throttles.ThrottlePolynomial:
  #                  &rotThrottle
  #                  '@id': rotThrottle
  #                  stick: driverGamepad
  #                  axis: 0
  #                  smoothingTimeSecs: 0.04
  #                  deadband: 0.08
  #                  inverted: false
  #                  polynomial:
  #                    org.usfirst.frc.team449.robot.generalInterfaces.doubleUnaryOperator.Polynomial:
  #                      '@id': rotPoly
  #                      powerToCoefficientMap: !!map
  #                        1: .5
  #                        3: .5
  #                  scale: .7
  #              fwdThrottle:
  #                org.usfirst.frc.team449.robot.oi.throttles.ThrottleSum:
  #                  '@id': fwdThrottle
  #                  throttles:
  #                    - org.usfirst.frc.team449.robot.oi.throttles.ThrottlePolynomial:
  #                        <<: *rotThrottle
  #                        '@id': posThrottle
  #                        axis: 3
  #                        inverted: false
  #                        deadband: 0.05
  #                        polynomial:
  #                          org.usfirst.frc.team449.robot.generalInterfaces.doubleUnaryOperator.Polynomial:
  #                            '@id': posPoly
  #                            powerToCoefficientMap: !!map
  #                              1: 2
  #                              3: 1
  #                    - org.usfirst.frc.team449.robot.oi.throttles.ThrottlePolynomial:
  #                        <<: *rotThrottle
  #                        '@id': negThrottle
  #                        axis: 2
  #                        inverted: true
  #                        deadband: 0.05
  #                        polynomial:
  #                          org.usfirst.frc.team449.robot.generalInterfaces.doubleUnaryOperator.Polynomial:
  #                            '@id': negPoly
  #                            powerToCoefficientMap: !!map
  #                              1: 2
  #                              3: 1
  #              invertDPad: false
  #              dPadShift: 0.1
  #              turnInPlaceRotScale: 1
  #              rescaleOutputs: true
  #              scaleRotByFwdPoly:
  #                org.usfirst.frc.team449.robot.generalInterfaces.doubleUnaryOperator.Polynomial:
  #                  '@id': scaleRotByFwdPoly
  #                  powerToCoefficientMap: !!map
  #                    0.5: 0.4
  #                    0: 0.2
  #                    #1 : 0.25
  #                    #2: 0.25
  #          autoshiftComponent:
  #            '@id': autoshiftComponent
  #            upshiftSpeed: 1.5
  #            downshiftSpeed: 1
  #            upshiftDebouncer:
  #              '@id': upshiftDebouncer
  #              bufferTimeSeconds: 0.06
  #            upshiftFwdThresh: 0.4

########################################################################################################################
#BUTTONS
  buttons:
    #    - button:
    #        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
    #          '@id': shiftdown
    #          joystick:
    #            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
    #              '@id': mechanismsJoystick
    #              port: 1
    #          buttonNumber: 6 #shoulder right
    #      command:
    #        org.usfirst.frc.team449.robot.commands.general.CommandSequence:
    #          '@id': overrideAndShift
    #          commandList:
    #            - org.usfirst.frc.team449.robot.drive.shifting.commands.OverrideAutoShift:
    #                '@id': overrideAutoshift
    #                drive:
    #                  org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
    #                    drive
    #                override: true
    #            - org.usfirst.frc.team449.robot.generalInterfaces.shiftable.commands.SwitchToLowGear:
    #                '@id': downshift
    #                subsystem:
    #                  org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
    #                    drive
    #      action: WHEN_PRESSED
    #    - button:
    #        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
    #          '@id': shiftUp
    #          joystick:
    #            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
    #              '@id': mechanismsJoystick
    #              port: 1
    #          buttonNumber: 5 #shoulder left
    #      command:
    #        org.usfirst.frc.team449.robot.commands.general.CommandSequence:
    #          '@id': overrideAndShift
    #          commandList:
    #            - org.usfirst.frc.team449.robot.drive.shifting.commands.OverrideAutoShift:
    #                '@id': overrideAutoshift
    #                drive:
    #                  org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
    #                    drive
    #                override: true
    #            - org.usfirst.frc.team449.robot.generalInterfaces.shiftable.commands.SwitchToHighGear:
    #                '@id': downshift
    #                subsystem:
    #                  org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
    #                    drive
    #      action: WHEN_PRESSED
    - button:
        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
          '@id': climberOffButton
          joystick:
            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
              '@id': mechanismsJoystick
              port: 0
          buttonNumber: 2 #B
      command:
        org.usfirst.frc.team449.robot.subsystem.interfaces.climber.commands.SetClimberWithArmState:
          '@id': climberOffCommand
          subsystem:
            org.usfirst.frc.team449.robot.subsystem.complex.climber.SafeWinchingClimber:
              climber
          state: "OFF"
      action: WHEN_PRESSED
    - button:
        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
          '@id': shooterStartButton
          joystick:
            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
              mechanismsJoystick
          buttonNumber: 4 #A
      command:
        org.usfirst.frc.team449.robot.commands.general.MappedSequentialCommandGroup:
          '@id': shooterStartCommandSequence
          commands:
            #todo check this
            - org.usfirst.frc.team449.robot.commands.multiSubsystem.LoadShooter:
                '@id': loadCommand
                subsystemFlywheel:
                  org.usfirst.frc.team449.robot.subsystem.complex.shooter.LoggingFlywheel:
                    shooterFlywheel
                subsystemIntake:
                    org.usfirst.frc.team449.robot.subsystem.interfaces.intake.IntakeSimple:
                      feeder
            - org.usfirst.frc.team449.robot.subsystem.interfaces.flywheel.commands.SpinUpFlywheel:
                &spinUpFlywheelCommand
                '@id': spinUpFlywheelCommand
                flywheel:
                  org.usfirst.frc.team449.robot.subsystem.complex.shooter.LoggingFlywheel:
                    shooterFlywheel
                feeder:
                  org.usfirst.frc.team449.robot.subsystem.interfaces.intake.IntakeSimple:
                    feeder
            - org.usfirst.frc.team449.robot.commands.general.MappedPerpetualCommand:
                '@id': startShootingOrSpinUpFlywheelCommmandPerpetual
                requires:
                  - org.usfirst.frc.team449.robot.subsystem.complex.shooter.LoggingFlywheel:
                      shooterFlywheel
                command:
                  org.usfirst.frc.team449.robot.commands.general.MappedSequentialCommandGroup:
                    '@id': startShootingOrSpinUpFlywheelCommmandSequence
                    commands:
                      - org.usfirst.frc.team449.robot.commands.general.MappedWaitCommand:
                          timeout: 1
                      - org.usfirst.frc.team449.robot.commands.general.ConditionalCommandSubsystemBased:
                          '@id': startShootingOrSpinUpFlywheelCommmand
                          onTrue:
                            org.usfirst.frc.team449.robot.subsystem.interfaces.flywheel.commands.TurnAllOn:
                              '@id': startShootingCommand
                              subsystem:
                                org.usfirst.frc.team449.robot.subsystem.complex.shooter.LoggingFlywheel:
                                  shooterFlywheel
                          onFalse:
                            org.usfirst.frc.team449.robot.subsystem.interfaces.flywheel.commands.SpinUpFlywheel:
                              <<: *spinUpFlywheelCommand
                              '@id': spinUpFlywheelCommand2
                          subsystem:
                              org.usfirst.frc.team449.robot.subsystem.complex.shooter.LoggingFlywheel:
                                shooterFlywheel
                          useCached: true
      action: WHILE_HELD
#    - button:
#        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
#          '@id': shooterStopButton
#          joystick:
#            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
#              mechanismsJoystick
#          buttonNumber: 2 #B
#      command:
#        org.usfirst.frc.team449.robot.subsystem.interfaces.flywheel.commands.TurnAllOffRequires:
#          '@id': shooterStopCommand
#          subsystem:
#            org.usfirst.frc.team449.robot.subsystem.complex.shooter.LoggingFlywheel:
#              shooterFlywheel
#      action: WHEN_PRESSED
#    - button:
#        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
#          '@id': intakeToggleButton
#          joystick:
#            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
#              mechanismsJoystick
#          buttonNumber: 3 #X
#      command:
#        org.usfirst.frc.team449.robot.subsystem.interfaces.intake.commands.ToggleIntaking:
#          '@id': feederToggleCommand
#          subsystem:
#            org.usfirst.frc.team449.robot.subsystem.interfaces.intake.IntakeSimple:
#              feeder
#          mode: IN_FAST
#      action: WHEN_PRESSED
    - button:
        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
          '@id': intakeStartButton
          joystick:
            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
              mechanismsJoystick
          buttonNumber: 3 #X
      command:
        org.usfirst.frc.team449.robot.subsystem.interfaces.intake.commands.SetIntakeMode:
          '@id': intakeStartCommand
          subsystem:
            org.usfirst.frc.team449.robot.subsystem.interfaces.intake.IntakeSimple:
              intake
          mode: IN_FAST
#        org.usfirst.frc.team449.robot.subsystem.interfaces.flywheel.commands.SpinUpThenShoot:
#          '@id': shootCommand
#          flywheel:
#            org.usfirst.frc.team449.robot.subsystem.complex.shooter.LoggingFlywheel:
#              shooterFlywheel
#          feeder:
#            org.usfirst.frc.team449.robot.subsystem.interfaces.intake.IntakeSimple:
#              feeder
      action: WHEN_PRESSED
    - button:
        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
          '@id': climberRaiseButton
          joystick:
            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
              mechanismsJoystick
          buttonNumber: 1 #A
      command:
        org.usfirst.frc.team449.robot.subsystem.interfaces.climber.commands.SetClimberWithArmState:
          '@id': climberRaiseCommand
          subsystem:
            org.usfirst.frc.team449.robot.subsystem.complex.climber.SafeWinchingClimber:
              climber
          state: "RAISE"
      action: WHEN_PRESSED
    - button:
        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
          '@id': climberLowerButton
          joystick:
            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
              mechanismsJoystick
          buttonNumber: 3 #Y
      command:
        org.usfirst.frc.team449.robot.subsystem.interfaces.climber.commands.SetClimberWithArmState:
          '@id': climberLowerCommand
          subsystem:
            org.usfirst.frc.team449.robot.subsystem.complex.climber.SafeWinchingClimber:
              climber
          state: "LOWER"
      action: WHEN_PRESSED
    - button:
        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
          '@id': climberWinchButton
          joystick:
            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
              mechanismsJoystick
          buttonNumber: 4 #X
      command:
        org.usfirst.frc.team449.robot.commands.general.InvokeMethodByNameCommand:
          '@id': climberWinchCommand
          object:
            org.usfirst.frc.team449.robot.subsystem.complex.climber.SafeWinchingClimber:
              climber
          method: turnMotorOn
      action: WHEN_PRESSED

    - button:
        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
          '@id': intakeStopButton
          joystick:
            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
              mechanismsJoystick
          buttonNumber: 4 #Y
      command:
        org.usfirst.frc.team449.robot.subsystem.interfaces.intake.commands.SetIntakeMode:
          '@id': intakeStopCommand
          subsystem:
            org.usfirst.frc.team449.robot.subsystem.interfaces.intake.IntakeSimple:
              intake
          mode: "OFF"
      action: WHEN_PRESSED

########################################################################################################################
# UPDATER
updater:
  org.usfirst.frc.team449.robot.other.Updater:
    '@id': updater
    updatables:
      #      - org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable: drive
      #      - org.usfirst.frc.team449.robot.oi.unidirectional.arcade.OIArcadeWithDPad: oi
      #      - org.usfirst.frc.team449.robot.jacksonWrappers.MappedAHRS: navX
      - org.usfirst.frc.team449.robot.subsystem.complex.climber.ClimberCurrentLimited: climberCurrentLimitSystem
      - org.usfirst.frc.team449.robot.jacksonWrappers.PDP: PDP
